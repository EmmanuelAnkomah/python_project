{% set GREEN = "#16A34A" %}
<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <title>My Tickets • AkwaabaTickets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="icon" href="https://res.cloudinary.com/dglubbbfb/image/upload/v1755834123/logo_hlxw5e.png">

  <style>
    :root{ --brand: {{ GREEN }}; --line:#e5e7eb; --muted:#64748b; }
    body{ background:#f8fafc; }
    .page-wrap{ padding: 1.25rem; }
    .cardish{ border:1px solid var(--line); border-radius:16px; background:#fff; box-shadow:0 10px 28px rgba(2,6,23,.06); }
    .btn-brand{ background:var(--brand); color:#fff; border:1px solid var(--brand); }
    .btn-outline-brand{ border:1px solid var(--brand); color:var(--brand); }
    .btn-outline-brand:hover{ background: rgba(22,163,74,.08); }
    .muted{ color: var(--muted); }
    .ticket-cover{ width: 120px; height: 80px; object-fit:cover; border-radius:12px; border:1px solid var(--line); }
    @media (max-width: 575.98px){ .ticket-cover{ width: 100%; height: 160px; } }
    .badge-soft{ background: rgba(22,163,74,.10); color:#0f6a31; border:1px solid rgba(22,163,74,.25); }
    .empty{ border:2px dashed var(--line); border-radius:16px; padding:2rem; background:#fff; }
  </style>
</head>
<body>
  {# Fixed sidebar that shifts content on desktop; drawer on mobile #}
  {% include "attendee_sidebar.html" %}

  <div class="page-wrap container-xxl">
    <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3">
      <div>
        <h1 class="h4 mb-0">My Tickets</h1>
        <div class="text-muted">Hi {{ name }}, here are your tickets and recent events.</div>
      </div>
      <form class="d-flex gap-2" action="{{ url_for('attendee.my_tickets') }}" method="get">
        <input class="form-control" name="q" value="{{ q or '' }}" placeholder="Search events, cities…">
        <button class="btn btn-outline-brand" type="submit"><i class="bi bi-search"></i></button>
      </form>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-3">
          {% for category, msg in messages %}
            <div class="alert alert-{{ 'success' if category=='success' else ('warning' if category=='warning' else 'danger') }} mb-2" role="alert">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <ul class="nav nav-pills gap-2 mb-3" id="tixTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="pill" data-bs-target="#upcoming-pane" type="button" role="tab">
          Upcoming <span class="badge text-bg-light border ms-1">{{ upcoming|length }}</span>
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="past-tab" data-bs-toggle="pill" data-bs-target="#past-pane" type="button" role="tab">
          Past <span class="badge text-bg-light border ms-1">{{ past|length }}</span>
        </button>
      </li>
    </ul>

    <div class="tab-content">
      <!-- UPCOMING -->
      <div class="tab-pane fade show active" id="upcoming-pane" role="tabpanel" aria-labelledby="upcoming-tab">
        {% if upcoming %}
          <div class="vstack gap-2">
            {% for t in upcoming %}
              <div class="cardish p-2">
                <div class="d-flex flex-wrap align-items-center gap-3">
                  <img class="ticket-cover" src="{{ t.event.cover }}" alt="">
                  <div class="flex-grow-1">
                    <div class="d-flex flex-wrap align-items-center gap-2">
                      <strong>{{ t.event.title }}</strong>
                      <span class="badge badge-soft">Upcoming</span>
                    </div>
                    <div class="small text-muted mt-1">
                      <i class="bi bi-calendar-event"></i> {{ t.event.when }}
                      &nbsp;•&nbsp; <i class="bi bi-geo-alt"></i> {{ t.event.where }}
                    </div>
                    <div class="small mt-1">
                      Ticket: <span class="fw-semibold">{{ t.tier.name }}</span>
                      {% if t.tier.price and t.tier.price > 0 %}
                        — USDC {{ '%.2f'|format(t.tier.price) }}
                      {% else %} — Free {% endif %}
                      &nbsp;•&nbsp; Status: <span class="text-success">{{ t.status }}</span>
                    </div>
                  </div>
                  <div class="ms-auto d-flex flex-column gap-2">
                    <a class="btn btn-brand" href="{{ t.event.url }}"><i class="bi bi-ticket-perforated me-1"></i> View event</a>
                    {% if t.event.ics_url %}
                      <a class="btn btn-outline-brand" href="{{ t.event.ics_url }}"><i class="bi bi-calendar-plus me-1"></i> Add to calendar</a>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty text-center">
            <div class="mb-2"><i class="bi bi-calendar2-check"></i></div>
            <p class="mb-2">No upcoming tickets yet.</p>
            <a class="btn btn-outline-brand" href="{{ url_for('public.browse_events') }}"><i class="bi bi-search me-1"></i> Find events</a>
          </div>
        {% endif %}
      </div>

      <!-- PAST -->
      <div class="tab-pane fade" id="past-pane" role="tabpanel" aria-labelledby="past-tab">
        {% if past %}
          <div class="vstack gap-2">
            {% for t in past %}
              <div class="cardish p-2">
                <div class="d-flex flex-wrap align-items-center gap-3">
                  <img class="ticket-cover" src="{{ t.event.cover }}" alt="">
                  <div class="flex-grow-1">
                    <div class="d-flex flex-wrap align-items-center gap-2">
                      <strong>{{ t.event.title }}</strong>
                      <span class="badge text-bg-light border">Attended</span>
                    </div>
                    <div class="small text-muted mt-1">
                      <i class="bi bi-calendar-event"></i> {{ t.event.when }}
                      &nbsp;•&nbsp; <i class="bi bi-geo-alt"></i> {{ t.event.where }}
                    </div>
                    <div class="small mt-1">
                      Ticket: <span class="fw-semibold">{{ t.tier.name }}</span>
                      {% if t.tier.price and t.tier.price > 0 %}
                        — USDC {{ '%.2f'|format(t.tier.price) }}
                      {% else %} — Free {% endif %}
                      &nbsp;•&nbsp; Purchased: {{ (t.purchased_at or '') }}
                    </div>
                  </div>
                  <div class="ms-auto d-flex flex-column gap-2">
                    <a class="btn btn-outline-secondary" href="{{ t.event.url }}"><i class="bi bi-info-circle me-1"></i> Event page</a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty text-center">
            <div class="mb-2"><i class="bi bi-clock-history"></i></div>
            <p class="mb-2">No past events yet.</p>
            <a class="btn btn-outline-brand" href="{{ url_for('public.browse_events') }}"><i class="bi bi-search me-1"></i> Browse events</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
