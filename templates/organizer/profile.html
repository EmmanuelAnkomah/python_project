{% set BLUE = "#0A6CFF" %} 
<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <title>Organizer Profile â€¢ AkwaabaTickets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
      <link rel="icon" href="https://res.cloudinary.com/dglubbbfb/image/upload/v1755834123/logo_hlxw5e.png">

  <style>
    :root{
      --brand: {{ BLUE }};
      --ink:#0b1b2b; --muted:#64748b; --line:#e5e7eb; --bg:#f8fafc;
      --radius:16px; --shadow:0 18px 48px rgba(2,6,23,.08);
    }
    body{ background:var(--bg); }
    .page-title{ display:flex; align-items:center; gap:12px; }
    .cardish{ border:1px solid var(--line); border-radius:var(--radius); background:#fff; box-shadow:var(--shadow); }
    .section-title{ font-weight:700; }
    .field{ border:1px solid var(--line); border-radius:12px; padding:.7rem .85rem; }
    .field:focus{ border-color:var(--brand); outline:0; box-shadow:0 0 0 4px rgba(10,108,255,.12); }
    .brand-btn{ background:var(--brand); color:#fff; border:none; border-radius:12px; padding:.7rem 1rem; }
    .avatar{
      width:88px; height:88px; border-radius:50%; object-fit:cover; border:3px solid #fff;
      box-shadow:0 6px 18px rgba(2,6,23,.15);
    }
    .copy-btn{ cursor:pointer; user-select:none; }
    .muted{ color:var(--muted); }
    .codepill{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#f1f5f9;
      border:1px dashed var(--line); padding:.35rem .6rem; border-radius:10px; }

    /* Coinbase CTA styling */
    .coinbase-btn{
      display:inline-flex; align-items:center; gap:.4rem;
      border-color: var(--line);
    }
    .coinbase-logo{ height:16px; width:auto; display:inline-block; }
    @media (max-width: 576px){
      .wallet-actions{ gap:.4rem !important; }
    }
  </style>
</head>
<body>
<div class="container py-4">
  {% include "_sidebar.html" %}

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="page-title">
      <div class="rounded-circle" style="width:36px;height:36px;background:rgba(10,108,255,.12);display:grid;place-items:center;color:var(--brand);font-weight:700;">â„¹</div>
      <div>
        <div class="fw-bold">Organizer Profile</div>
        <div class="small muted">Manage your details, password, and payout wallet</div>
      </div>
    </div>
    <a href="{{ url_for('organizer.dashboard') }}" class="text-decoration-none" style="color:var(--brand)">Back to dashboard</a>
  </div>

  <div class="row g-4">
    <!-- Left: Profile & Wallet -->
    <div class="col-12 col-lg-7">
      <form class="cardish p-3 p-md-4" method="post" action="{{ url_for('organizer.organizer_profile_update') }}" enctype="multipart/form-data">
        <div class="d-flex align-items-center gap-3 mb-3">
          <img class="avatar" id="avatarPreview" src="{{ me.avatar_url or 'https://api.dicebear.com/7.x/initials/svg?seed=' ~ (me.full_name or 'User') }}" alt="avatar">
          <div>
            <div class="fw-bold">{{ me.full_name }}</div>
            <div class="small muted">{{ me.email }}</div>
            <label class="btn btn-sm btn-outline-secondary mt-2">
              Change avatar <input name="avatar" type="file" accept=".png,.jpg,.jpeg,.webp,.gif" class="d-none" onchange="previewAvatar(this)">
            </label>
          </div>
        </div>
        <hr class="my-3">

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Full name</label>
            <input name="full_name" class="form-control field" required value="{{ me.full_name or '' }}">
          </div>
          <div class="col-md-6">
            <label class="form-label">Email</label>
            <input name="email" type="email" class="form-control field" required value="{{ me.email or '' }}">
          </div>
          <div class="col-md-6">
            <label class="form-label">Phone</label>
            <input name="phone" class="form-control field" placeholder="+233..." value="{{ me.phone or '' }}">
          </div>

          <!-- Wallet block with Coinbase CTA -->
          <div class="col-md-6">
            <label class="form-label">Wallet address (payout)</label>
            <div class="input-group">
              <!-- Basic EVM-style pattern; adjust as needed if you support other chains -->
              <input
                id="walletField"
                name="wallet_address"
                class="form-control field"
                value="{{ payout_address or '' }}"
                placeholder="0x..."
                pattern="^0x[a-fA-F0-9]{40}$"
                title="EVM address: starts with 0x and has 40 hex characters"
                autocomplete="off" spellcheck="false">
              <button type="button" class="btn btn-outline-secondary" onclick="pasteWallet()" title="Paste from clipboard">
                <i class="bi bi-clipboard-plus"></i> Paste
              </button>
              <button type="button" class="btn btn-outline-secondary copy-btn" onclick="copyWallet()" title="Copy to clipboard">
                <i class="bi bi-clipboard"></i> Copy
              </button>
              <!-- Coinbase: Get account -->
              <a
                class="btn btn-outline-secondary coinbase-btn"
                href="https://www.coinbase.com/"
                target="_blank" rel="noopener"
                title="Create your Coinbase account">
                  <img class="coinbase-logo" src="https://images.ctfassets.net/q5ulk4bp65r7/3TBS4oVkD1ghowTqVQJlqj/2dfd4ea3b623a7c0d8deb2ff445dee9e/Consumer_Wordmark.svg" alt="Coinbase">
                  Get account
              </a>
            </div>
            <div class="small muted mt-1">
              Used for ticket payouts. Stored in both <span class="codepill">wallet_address</span> and
              <span class="codepill">settings.payout_address</span>.
            </div>
          </div>
        </div>

        <div class="mt-3 d-flex gap-2 wallet-actions">
          <button class="btn brand-btn">Save changes</button>
          <a class="btn btn-outline-secondary" href="{{ url_for('organizer.dashboard') }}">Cancel</a>
        </div>
      </form>
    </div>

    <!-- Right: Security -->
    <div class="col-12 col-lg-5">
      <form class="cardish p-3 p-md-4" method="post" action="{{ url_for('organizer.organizer_profile_change_password') }}">
        <div class="d-flex align-items-center gap-2 mb-2">
          <div class="rounded-circle" style="width:28px;height:28px;background:rgba(10,108,255,.12);display:grid;place-items:center;color:var(--brand);font-weight:700;">ðŸ”’</div>
          <div class="section-title">Security</div>
        </div>
        <div class="small muted mb-3">Update your password. Minimum 8 chars with letters & numbers.</div>

        <div class="mb-3">
          <label class="form-label">Current password</label>
          <div class="input-group">
            <input id="curPw" name="current_password" type="password" class="form-control field" required>
            <button class="btn btn-outline-secondary" type="button" onclick="toggleVis('curPw', this)">Show</button>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">New password</label>
          <div class="input-group">
            <input id="newPw" name="new_password" type="password" class="form-control field" required>
            <button class="btn btn-outline-secondary" type="button" onclick="toggleVis('newPw', this)">Show</button>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Confirm new password</label>
          <div class="input-group">
            <input id="confPw" name="confirm_password" type="password" class="form-control field" required>
            <button class="btn btn-outline-secondary" type="button" onclick="toggleVis('confPw', this)">Show</button>
          </div>
        </div>

        <div class="d-grid">
          <button class="btn brand-btn">Update password</button>
        </div>
      </form>

      <div class="cardish p-3 p-md-4 mt-3">
        <div class="section-title mb-2">Account</div>
        <div class="small">
          <div><span class="muted">Status:</span> {{ me.status or 'active' }}</div>
          <div><span class="muted">Created:</span> {{ me.created_at }}</div>
          <div><span class="muted">Last login:</span> {{ me.last_login_at or 'â€”' }}</div>
          <div><span class="muted">Email verified:</span> {{ (me.settings.email_verified if me.settings else False) | default(False) }}</div>
          <div><span class="muted">Phone verified:</span> {{ (me.settings.phone_verified if me.settings else False) | default(False) }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function toggleVis(id, btn){
  const el = document.getElementById(id);
  const isPwd = el.type === 'password';
  el.type = isPwd ? 'text' : 'password';
  btn.textContent = isPwd ? 'Hide' : 'Show';
}
function previewAvatar(input){
  const file = input.files && input.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => { document.getElementById('avatarPreview').src = e.target.result; };
  reader.readAsDataURL(file);
}
async function copyWallet(){
  const w = document.getElementById('walletField');
  try{
    await navigator.clipboard.writeText(w.value || '');
  }catch(e){
    w.select(); w.setSelectionRange(0, 99999);
    document.execCommand('copy');
  }
}
async function pasteWallet(){
  try{
    const txt = await navigator.clipboard.readText();
    if(!txt) return;
    const w = document.getElementById('walletField');
    w.value = txt.trim();
    // optional: basic pattern check to give quick feedback
    if(!/^0x[a-fA-F0-9]{40}$/.test(w.value)){
      w.setCustomValidity('Expected an EVM address like 0x followed by 40 hex characters.');
      w.reportValidity();
      setTimeout(()=>w.setCustomValidity(''), 1500);
    }
  }catch(e){
    // Clipboard read may be blocked if not triggered by user gesture
  }
}
</script>
<script>
  window.cbConfig = {
    chatId: "0607a799-b5e6-484e-afb2-482ff18b5b4e"
  };
</script>
<script src="https://app.chatbit.co/embed.min.js" defer></script>
</body>
</html>
